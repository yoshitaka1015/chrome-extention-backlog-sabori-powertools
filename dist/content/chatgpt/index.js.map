{
  "version": 3,
  "sources": ["../../../src/content/chatgpt/index.ts"],
  "sourcesContent": ["function announceReady() {\n  chrome.runtime.sendMessage({ type: \"chatgpt:content-ready\" }).catch(() => {\n    // Ignored: the background might not be listening yet.\n  });\n}\n\nfunction extractLatestAssistantJson(): { json: unknown; raw: string } | null {\n  const messageNodes = Array.from(\n    document.querySelectorAll<HTMLDivElement>(\"[data-message-author-role='assistant'] .markdown\")\n  );\n\n  for (let index = messageNodes.length - 1; index >= 0; index -= 1) {\n    const node = messageNodes[index];\n    const candidates = collectJsonCandidates(node);\n    for (const candidate of candidates) {\n      const parsed = tryParseJson(candidate);\n      if (parsed) {\n        return parsed;\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction collectJsonCandidates(node: HTMLElement): string[] {\n  const candidates = new Set<string>();\n  const codeBlocks = Array.from(node.querySelectorAll(\"pre code\"));\n  codeBlocks.forEach((block) => {\n    const text = block.textContent?.trim();\n    if (text) {\n      candidates.add(text);\n    }\n  });\n\n  const rawText = node.textContent?.trim();\n  if (rawText) {\n    candidates.add(rawText);\n    const match = rawText.match(/\\{[\\s\\S]*\\}/);\n    if (match) {\n      candidates.add(match[0].trim());\n    }\n  }\n\n  return Array.from(candidates).filter((candidate) => candidate.startsWith(\"{\"));\n}\n\nfunction tryParseJson(source: string): { json: unknown; raw: string } | null {\n  const trimmed = source.trim();\n  if (!trimmed) {\n    return null;\n  }\n\n  try {\n    const parsed = JSON.parse(trimmed);\n    if (parsed && typeof parsed === \"object\") {\n      return { json: parsed, raw: trimmed };\n    }\n  } catch (error) {\n    console.debug(\"Failed to parse ChatGPT JSON candidate\", error, trimmed);\n  }\n\n  return null;\n}\n\nchrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\n  if (message?.type === \"chatgpt:extract-json\") {\n    try {\n      const result = extractLatestAssistantJson();\n      if (!result) {\n        sendResponse({ ok: false, error: \"ChatGPT \u306E\u56DE\u7B54\u304B\u3089 JSON \u3092\u691C\u51FA\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\" });\n        return;\n      }\n      sendResponse({ ok: true, data: result.json, raw: result.raw });\n    } catch (error) {\n      const messageText = error instanceof Error ? error.message : String(error);\n      sendResponse({ ok: false, error: messageText });\n    }\n  }\n});\n\nannounceReady();\n"],
  "mappings": ";AAAA,SAAS,gBAAgB;AACvB,SAAO,QAAQ,YAAY,EAAE,MAAM,wBAAwB,CAAC,EAAE,MAAM,MAAM;AAAA,EAE1E,CAAC;AACH;AAEA,SAAS,6BAAoE;AAC3E,QAAM,eAAe,MAAM;AAAA,IACzB,SAAS,iBAAiC,kDAAkD;AAAA,EAC9F;AAEA,WAAS,QAAQ,aAAa,SAAS,GAAG,SAAS,GAAG,SAAS,GAAG;AAChE,UAAM,OAAO,aAAa,KAAK;AAC/B,UAAM,aAAa,sBAAsB,IAAI;AAC7C,eAAW,aAAa,YAAY;AAClC,YAAM,SAAS,aAAa,SAAS;AACrC,UAAI,QAAQ;AACV,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAEA,SAAS,sBAAsB,MAA6B;AAC1D,QAAM,aAAa,oBAAI,IAAY;AACnC,QAAM,aAAa,MAAM,KAAK,KAAK,iBAAiB,UAAU,CAAC;AAC/D,aAAW,QAAQ,CAAC,UAAU;AAC5B,UAAM,OAAO,MAAM,aAAa,KAAK;AACrC,QAAI,MAAM;AACR,iBAAW,IAAI,IAAI;AAAA,IACrB;AAAA,EACF,CAAC;AAED,QAAM,UAAU,KAAK,aAAa,KAAK;AACvC,MAAI,SAAS;AACX,eAAW,IAAI,OAAO;AACtB,UAAM,QAAQ,QAAQ,MAAM,aAAa;AACzC,QAAI,OAAO;AACT,iBAAW,IAAI,MAAM,CAAC,EAAE,KAAK,CAAC;AAAA,IAChC;AAAA,EACF;AAEA,SAAO,MAAM,KAAK,UAAU,EAAE,OAAO,CAAC,cAAc,UAAU,WAAW,GAAG,CAAC;AAC/E;AAEA,SAAS,aAAa,QAAuD;AAC3E,QAAM,UAAU,OAAO,KAAK;AAC5B,MAAI,CAAC,SAAS;AACZ,WAAO;AAAA,EACT;AAEA,MAAI;AACF,UAAM,SAAS,KAAK,MAAM,OAAO;AACjC,QAAI,UAAU,OAAO,WAAW,UAAU;AACxC,aAAO,EAAE,MAAM,QAAQ,KAAK,QAAQ;AAAA,IACtC;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,0CAA0C,OAAO,OAAO;AAAA,EACxE;AAEA,SAAO;AACT;AAEA,OAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,SAAS,iBAAiB;AACvE,MAAI,SAAS,SAAS,wBAAwB;AAC5C,QAAI;AACF,YAAM,SAAS,2BAA2B;AAC1C,UAAI,CAAC,QAAQ;AACX,qBAAa,EAAE,IAAI,OAAO,OAAO,uHAAkC,CAAC;AACpE;AAAA,MACF;AACA,mBAAa,EAAE,IAAI,MAAM,MAAM,OAAO,MAAM,KAAK,OAAO,IAAI,CAAC;AAAA,IAC/D,SAAS,OAAO;AACd,YAAM,cAAc,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AACzE,mBAAa,EAAE,IAAI,OAAO,OAAO,YAAY,CAAC;AAAA,IAChD;AAAA,EACF;AACF,CAAC;AAED,cAAc;",
  "names": []
}
